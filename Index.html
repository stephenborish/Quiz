<!DOCTYPE html>
<html>
  <head>
    <title>LMS Resource Generator</title>
    <meta charset="utf-8">
    <style>
      body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; padding: 20px; background: #f0f2f5; color: #333; }
      h1 { text-align: center; color: #1a73e8; margin-bottom: 25px; font-weight: 600; }
      .main-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); max-width: 1200px; margin: 0 auto; }
      .layout-container { display: flex; gap: 30px; align-items: flex-start; }
      .left-panel { flex: 0 0 450px; display: flex; flex-direction: column; gap: 20px; }
      .right-panel { flex: 1; display: flex; flex-direction: column; gap: 20px; position: sticky; top: 20px; }
      @media (max-width: 900px) { .layout-container { flex-direction: column; } .left-panel, .right-panel { flex: 1; width: 100%; } }
      .control-group { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e1e4e8; }
      .control-group h3 { margin: 0 0 12px 0; font-size: 13px; font-weight: 700; text-transform: uppercase; color: #5f6368; border-bottom: 2px solid #e1e4e8; padding-bottom: 8px; }
      textarea { width: 100%; padding: 12px; border: 1px solid #dadce0; border-radius: 6px; font-family: monospace; font-size: 13px; box-sizing: border-box; resize: vertical; }
      textarea:focus { outline: 2px solid #1a73e8; border-color: transparent; }
      select { width: 100%; padding: 8px; border: 1px solid #dadce0; border-radius: 4px; background: white; margin-bottom: 10px; font-size: 14px; }
      label { display: flex; align-items: center; gap: 10px; font-size: 14px; margin-bottom: 8px; cursor: pointer; user-select: none; }
      input[type="checkbox"], input[type="radio"] { accent-color: #1a73e8; transform: scale(1.2); cursor: pointer; }
      .sub-label { font-size: 13px; margin: 10px 0 5px; font-weight: bold; color: #444; }
      .input-row { display: flex; gap: 10px; margin-top: 5px; margin-bottom: 10px; }
      input[type="number"] { padding: 6px; border: 1px solid #ccc; border-radius: 4px; }
      .fine-tune { margin-left: 28px; margin-bottom: 12px; padding: 8px; background: #fff; border: 1px dashed #ccc; border-radius: 4px; font-size: 13px; display: flex; flex-wrap: wrap; gap: 15px; align-items: center; }
      .fine-tune-item { display: flex; align-items: center; gap: 6px; }
      .fine-tune input { width: 50px; }
      .button-group { display: flex; gap: 10px; margin-bottom: 10px; }
      button { padding: 12px 20px; font-size: 15px; font-weight: 600; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s; height: 45px; }
      .btn-generate { background: #1a73e8; color: white; flex: 2; }
      .btn-generate:hover { background: #1557b0; }
      .btn-generate:disabled { background: #9aa0a6; cursor: not-allowed; }
      .btn-copy { background: #34a853; color: white; flex: 1; }
      .btn-copy:hover { background: #2d8e47; }
      .btn-clear { background: #ea4335; color: white; flex: 0.5; }
      .btn-clear:hover { background: #c5221f; }
      #previewContainer { border: 2px dashed #dadce0; border-radius: 8px; padding: 20px; background: #fafafa; min-height: 250px; display: flex; flex-direction: column; gap: 20px; align-items: center; justify-content: center; }
      #embedCodeOutput { min-height: 150px; font-family: 'Consolas', 'Monaco', monospace; font-size: 12px; background: #f8f9fa; }
      #toast { visibility: hidden; min-width: 250px; background: #323232; color: #fff; text-align: center; border-radius: 4px; padding: 16px; position: fixed; z-index: 1000; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.3s, bottom 0.3s; }
      #toast.show { visibility: visible; opacity: 1; bottom: 50px; }
    </style>
  </head>
  <body>
    <div class="main-card">
      <h1>LMS Resource Generator</h1>
      <div class="layout-container">
        <div class="left-panel">
          <div>
            <label for="urlInput"><strong>1. Paste URLs:</strong></label>
            <textarea id="urlInput" rows="4" placeholder="https://www.youtube.com/watch?v=...\nhttps://drive.google.com/file/d/..."></textarea>
          </div>
          <div class="control-group">
            <h3>Global Settings</h3>
            <div class="sub-label">Load Priority:</div>
            <select id="loadMode">
              <option value="eager" selected>High (Load Immediately)</option>
              <option value="lazy">Low (Lazy Load)</option>
            </select>
            <div class="sub-label">Aspect Ratio:</div>
            <select id="aspectRatio">
              <option value="16/9" selected>16:9 (Widescreen)</option>
              <option value="4/3">4:3 (Standard)</option>
              <option value="fixed">Fixed Height (500px)</option>
            </select>
            
            <label title="Covers the pop-out button with a shield.">
              <input type="checkbox" id="blockPopouts" checked> Block Pop-outs (Safe Mode)
            </label>
          </div>
          <div class="control-group">
            <h3>Slides & Shields</h3>
            <div class="sub-label">Features:</div>
            <label><input type="checkbox" id="hideSlideNav"> Hide Nav Bar</label>
            <label><input type="checkbox" id="autoAdvance"> Auto-Advance & Loop</label>
            <div class="sub-label" style="color:#d93025; margin-top:15px;">Interaction Shields:</div>
            
            <label title="Covers the main slide area."><input type="checkbox" id="maskContent"> Top Content Shield (Main)</label>

            <label><input type="checkbox" id="maskSlideNum" checked> Block Slide # (Left)</label>
            <div class="fine-tune">
              <div class="fine-tune-item"><span>Start:</span><input type="number" id="shieldLeftStart" value="42"></div>
              <div class="fine-tune-item"><span>Width:</span><input type="number" id="shieldLeftWidth" value="48"></div>
            </div>

            <label><input type="checkbox" id="maskMenu" checked> Block Menu (Right)</label>
            <div class="fine-tune">
              <div class="fine-tune-item"><span>Start:</span><input type="number" id="shieldRightStart" value="125"></div>
            </div>
            
            <label style="margin-top: 10px; font-weight: bold; color: red;">
              <input type="checkbox" id="debugShields"> ðŸ”´ Debug Mode
            </label>
          </div>
          <div class="control-group">
            <h3>YouTube & Docs</h3>
            <label><input type="checkbox" id="limitRel" checked> Limit Related Videos</label>
            <label><input type="checkbox" id="forceCaptions"> Force Captions</label>
            <div class="sub-label">Clip (Seconds):</div>
            <div class="input-row">
              <input type="number" id="startTime" placeholder="Start" min="0">
              <input type="number" id="endTime" placeholder="End" min="0">
            </div>
            <hr style="border:0; border-top:1px solid #e0e0e0; margin:10px 0;">
            <div class="sub-label">Drive Link:</div>
            <div class="input-row" style="margin-bottom:0;">
              <label style="margin-right:10px;"><input type="radio" name="driveMode" value="video" checked> Video</label>
              <label><input type="radio" name="driveMode" value="image"> Photo</label>
            </div>
            <div class="sub-label">Doc Mode:</div>
            <div class="input-row" style="margin-bottom:0;">
              <label style="margin-right:10px;"><input type="radio" name="docMode" value="preview" checked> Embed</label>
              <label><input type="radio" name="docMode" value="download"> PDF</label>
            </div>
          </div>
        </div> 
        <div class="right-panel">
          <div class="button-group">
            <button class="btn-generate" onclick="generateCodes()">Generate & Preview</button>
            <button class="btn-copy" onclick="copyToClipboard()">Copy Code</button>
            <button class="btn-clear" onclick="clearAll()">Clear</button>
          </div>
          <div>
            <label for="embedCodeOutput"><strong>2. Result Code:</strong></label>
            <textarea id="embedCodeOutput" placeholder="Generated HTML will appear here..."></textarea>
          </div>
          <div>
            <label><strong>3. Live Preview:</strong></label>
            <div id="previewContainer">
              <span style="color: #999; font-style: italic;">Preview will appear here...</span>
            </div>
          </div>
        </div> 
      </div> 
    </div>
    <div id="toast">Copied to clipboard!</div>
    <script>
      function generateCodes() {
        var urls = document.getElementById('urlInput').value;
        var docMode = document.querySelector('input[name="docMode"]:checked').value;
        var driveMode = document.querySelector('input[name="driveMode"]:checked').value;
        var aspectRatio = document.getElementById('aspectRatio').value;
        var loadMode = document.getElementById('loadMode').value;
        var options = {
          aspectRatio: aspectRatio,
          loadMode: loadMode,
          blockPopouts: document.getElementById('blockPopouts').checked,
          limitRelated: document.getElementById('limitRel').checked,
          forceCaptions: document.getElementById('forceCaptions').checked,
          startTime: document.getElementById('startTime').value,
          endTime: document.getElementById('endTime').value,
          hideSlideNav: document.getElementById('hideSlideNav').checked,
          autoAdvance: document.getElementById('autoAdvance').checked,
          maskContent: document.getElementById('maskContent').checked,
          maskMenu: document.getElementById('maskMenu').checked,
          maskSlideNum: document.getElementById('maskSlideNum').checked,
          debugShields: document.getElementById('debugShields').checked,
          shieldLeftStart: document.getElementById('shieldLeftStart').value,
          shieldLeftWidth: document.getElementById('shieldLeftWidth').value,
          shieldRightStart: document.getElementById('shieldRightStart').value,
          docMode: docMode,
          driveMode: driveMode
        };
        const genBtn = document.querySelector('.btn-generate');
        const oldText = genBtn.innerText;
        genBtn.innerText = "Processing...";
        genBtn.disabled = true;
        google.script.run
          .withSuccessHandler(function(response) {
            document.getElementById('embedCodeOutput').value = response;
            var previewBox = document.getElementById('previewContainer');
            if(response.trim() === "") { previewBox.innerHTML = '<span style="color: #999; font-style: italic;">No URL provided.</span>'; } 
            else { previewBox.innerHTML = response; }
            genBtn.innerText = oldText;
            genBtn.disabled = false;
          })
          .withFailureHandler(function(err) {
            document.getElementById('embedCodeOutput').value = "Error: " + err;
            genBtn.innerText = oldText;
            genBtn.disabled = false;
          })
          .generateEmbedCodes(urls, options);
      }
      function clearAll() {
        document.getElementById('urlInput').value = '';
        document.getElementById('embedCodeOutput').value = '';
        document.getElementById('previewContainer').innerHTML = '<span style="color: #999; font-style: italic;">Preview will appear here...</span>';
        document.getElementById('startTime').value = '';
        document.getElementById('endTime').value = '';
        document.getElementById('loadMode').value = 'eager';
        document.getElementById('aspectRatio').value = '16/9';
        
        // DEFAULTS
        document.getElementById('blockPopouts').checked = true; // Auto-checked
        document.getElementById('maskContent').checked = false; // Off by default to allow clicking
        document.getElementById('maskMenu').checked = true;
        document.getElementById('maskSlideNum').checked = true;
        
        document.getElementById('limitRel').checked = true;
        document.getElementById('forceCaptions').checked = false;
        document.getElementById('hideSlideNav').checked = false;
        document.getElementById('autoAdvance').checked = false;
        document.getElementById('debugShields').checked = false;
        document.getElementById('shieldLeftStart').value = 42;
        document.getElementById('shieldLeftWidth').value = 48;
        document.getElementById('shieldRightStart').value = 125;
        document.querySelector('input[name="docMode"][value="preview"]').checked = true;
        document.querySelector('input[name="driveMode"][value="video"]').checked = true;
      }
      function copyToClipboard() {
        var copyText = document.getElementById("embedCodeOutput");
        copyText.select();
        copyText.setSelectionRange(0, 99999); 
        try { var successful = document.execCommand('copy'); if(successful) showToast(); } catch (err) { alert('Unable to copy automatically.'); }
      }
      function showToast() {
        var x = document.getElementById("toast");
        x.className = "show";
        setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
      }
    </script>
  </body>
</html>
